

/* /home/vagrant/projects/honeybee-showcase/app/modules/Organization/resources/scripts/organization.namespace.js */

var midas=midas||{};midas.organization=midas.organization||{};

/* /home/vagrant/projects/honeybee-showcase/app/modules/Organization/resources/scripts/CategoryPicker.js */

midas.organization.CategoryPicker=midas.core.BaseObject.extend({log_prefix:"CategoryPicker",category_prompt:null,categories_uri:null,currently_valid:null,init:function(e){this.parent();var t=this;this.categories_uri=e,this.category_prompt=$("#batchAssignNewCategoryModal").twodal({show:!1,backdrop:!0,events:{categoryselect:this.onCategorySelected.bind(this)}}),this.currently_valid={},this.category_prompt.find("input").typeahead({property:"name",items:50,source:this.fetchAutoCompData.bind(this)})},fetchAutoCompData:function(e,t){if(0>=t.length){e.process([]),this.currently_valid={};return}var n=this,r=midas.core.Request.curry(this.categories_uri.replace("{PHRASE}",t));r(function(t){var r=t.data;this.currently_valid={};for(var i=0;i<r.length;i++)n.currently_valid[r[i].name]=r[i].identifier;e.process(r)})},show:function(){return this.category_prompt.twodal("show"),this.category_prompt.find("input").first().focus(),this},hide:function(){return this.category_prompt.twodal("hide"),this},onCategorySelected:function(){var e=this.category_prompt.twodal("promptVal","input");this.validate(e)&&this.fire("category::selected",[{id:this.currently_valid[e],name:e}])},validate:function(e){for(var t in this.currently_valid)console.log(t,this.currently_valid[t]);return"undefined"!=typeof this.currently_valid[e]},reset:function(){return this.category_prompt.twodal("promptVal","input",""),this}});

/* /home/vagrant/projects/honeybee-showcase/app/modules/Organization/resources/scripts/organization.ListController.js */

midas.organization.OrganizationListController=midas.list.ListController.extend({log_prefix:"OrganizationListController",category_picker:null,init:function(e){this.parent(e),this.category_picker=new midas.organization.CategoryPicker(this.options.category_batch.autocomplete_url)},assignCategory:function(e,t){var n=this,r=function(t){n.category_picker.hide().reset().removeListener("category::selected",r);var i=!0===e?n.getSelectedItems():[item];n.createCategoryBatch(i,t).run()};this.category_picker.on("category::selected",r).show()},createCategoryBatch:function(e,t){var n=new midas.list.ActionBatch;for(var r=0;r<e.length;r++)n.addAction(new midas.list.Action(this.createCategoryBatchPayload(e[r],t)));return n.on("complete",function(){window.location.href=window.location.href}),n},createCategoryBatchPayload:function(e,t){var n=this.options.category_batch.post_url.replace("{ID}",e.data.identifier);return midas.core.Request.curry(n,{organization:{category:[t.id]}},"post")}});

/* /home/vagrant/projects/honeybee-showcase/app/modules/Organization/resources/scripts/organization.init.js */

(function(e){var t=function(){var e=$(".controller-edit .form-actions"),t=$(".footer"),n=e.height(),r=$(document).height(),i=function(){var r=t.offset().top,i=e.offset(),s=i.top+n,o=$(document).scrollTop()+$(window).height(),u=o-r;u>=0?(e.removeClass("overlayed"),e.css("bottom",u-t.height()+3)):(e.addClass("overlayed"),e.css("bottom","-20px"))};$(document).scroll(i),$('a[data-toggle="tab"]').on("shown",i),$(window).resize(i)},n=$(".controller-edit"),r=$(".container-list-data");1===n.length?(midas.core.EditController.factory(".controller-edit"),t()):1===r.length&&midas.list.ListController.create(".container-list-data",e).attach()})(midas.organization);
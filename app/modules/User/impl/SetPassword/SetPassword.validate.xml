<?xml version="1.0" encoding="UTF-8"?>
<ae:configurations
    xmlns="http://agavi.org/agavi/config/parts/validators/1.0"
    xmlns:ae="http://agavi.org/agavi/config/global/envelope/1.0"
    parent="%core.module_dir%/User/config/validators.xml">
    <ae:configuration>
        <validators>

            <validator class="UserTokenValidator" name="invalid_token" required="true" provides="user_token">
                <argument>token</argument>
                <ae:parameter name="token_argument_name">token</ae:parameter>
                <ae:parameter name="export">user</ae:parameter>
                <error for="invalid_token">The given user token is invalid.</error>
            </validator>

            <validator class="PasswordValidator" name="minimum_password_complexity" method="write" required="true" depends="user_token">
                <argument>password</argument>
                <error> Your password does not meet the minimum complexity rules.&lt;br/&gt;&lt;br/&gt;
                It must contain at least 6 characters with at least 1 uppercase character, 1 lowercase character and 1 decimal number.
                Please note, that it should also not be too similar to your login name, email or company name.</error>
                <error for="too_short">Password is too short.</error>
                <error for="too_long">Password is too long.</error>
                <error for="repeat_password_mismatch">The repeated password does not match.</error>
                <error for="password_too_similar">Password is too similar to one of the following attributes: 
                username, firstname, lastname or email.</error>
                <error for="not_enough_uppercase_tokens">Password does not contain enough uppercase tokens.</error>
                <error for="not_enough_lowercase_tokens">Password does not contain enough lowercase tokens.</error>
                <error for="too_easy_to_guess">Password is too common and therefore easy to guess.</error>
                <ae:parameters>
                    <!-- basic password security -->
                    <ae:parameter name="min_decimal_numbers">%pwd_security.min_decimal_numbers%</ae:parameter>
                    <ae:parameter name="min_uppercase_chars">%pwd_security.min_uppercase_chars%</ae:parameter>
                    <ae:parameter name="min_lowercase_chars">%pwd_security.min_lowercase_chars%</ae:parameter>
                    <ae:parameter name="min_string_length">%pwd_security.min_string_length%</ae:parameter>
                    <ae:parameter name="max_string_length">%pwd_security.max_string_length%</ae:parameter>
                    <!-- require enough distance from the other user attributes -->
                    <ae:parameter name="argument_names_for_similarity_check">
                        <ae:parameter>firstname</ae:parameter>
                        <ae:parameter>lastname</ae:parameter>
                        <ae:parameter>username</ae:parameter>
                        <ae:parameter>email</ae:parameter>
                    </ae:parameter>
                    <ae:parameter name="similarity_percentage_threshold">%pwd_security.similarity_percentage_threshold%</ae:parameter>
                    <ae:parameter name="minimum_levenshtein_distance">%pwd_security.minimum_levenshtein_distance%</ae:parameter>
                    <!-- disallow common passwords -->
                    <ae:parameter name="common_passwords_blacklist_file">%core.modules_dir%/User/config/password_variants_blacklist.txt</ae:parameter>
                    <!-- arguments that hold the required token and optional password challenge -->
                    <ae:parameter name="token_argument_name">token</ae:parameter>
                    <ae:parameter name="repeat_password_argument_name">password_repeat</ae:parameter>
                    <!-- export the validated UserDocument to a 'user' request key -->
                    <ae:parameter name="export">user</ae:parameter>
                    <ae:parameter name="clear_password">true</ae:parameter>
                </ae:parameters>
            </validator>

        </validators>
    </ae:configuration>
</ae:configurations>
